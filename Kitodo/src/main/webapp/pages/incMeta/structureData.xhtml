<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ (c) Kitodo. Key to digital objects e. V. <contact@kitodo.org>
  ~
  ~ This file is part of the Kitodo project.
  ~
  ~ It is licensed under GNU General Public License version 3 or later.
  ~
  ~ For the full copyright and license information, please read the
  ~ GPL3-License.txt file that was distributed with this source code.
  -->

<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui">
    <h:form id="structureData">

        <p:messages id="messagesStructureData" closable="true"/>

        <h:panelGroup id="structureDataTable" rendered="#{!empty Metadaten.myMetadaten}">

            <p:treeTable value="#{Metadaten.treeNodes}" var="item" selectionMode="single"
                         selection="#{Metadaten.selectedTreeNode}">
                <f:facet name="header">
                    #{msgs.strukturdaten}
                </f:facet>

                <p:column headerText="#{msgs.typ}" style="width:20%">
                    <h:outputText value="#{item.type.getNameByLanguage(SpracheForm.locale)}"/>
                    <!--TODO Buttons should to bee aligned right-->
                    <p:commandButton icon="ui-icon-pencil"
                                     update="tabView:dialogEditDocStrucTypeForm:docStructTypeSelection"
                                     title="#{msgs.docstructTypeAendern}"
                                     onclick="PF('dialogEditDocStrucType').show();">
                        <f:setPropertyActionListener value="#{item}" target="#{Metadaten.myStrukturelement}"/>
                    </p:commandButton>
                </p:column>

                <p:column headerText="#{msgs.haupttitel}">
                    <h:outputText value="#{Metadaten.getMetadataByElementAndType(item,'TitleDocMain')}"/>
                </p:column>

                <p:column headerText="#{msgs.imageNumber}" style="width:20%">
                    <h:outputText value="#{Metadaten.getImageRangeByElement(item)}"/>
                    <!--TODO Buttons should to bee aligned right-->
                    <p:commandButton icon="ui-icon-pencil"
                                     update="tabView:dialogEditPagesForm:paginationSubSelection"
                                     title="#{msgs.docstructTypeAendern}"
                                     onclick="PF('dialogEditPages').show();">
                        <f:setPropertyActionListener value="#{item}" target="#{Metadaten.myStrukturelement}"/>
                    </p:commandButton>
                </p:column>

                <p:column headerText="#{msgs.auswahl}" style="width:64px;text-align: center">

                    <p:commandButton icon="ui-icon-plus"
                                     update="tabView:dialogAddDocStrucTypeForm:docStructAddTypeSelection"
                                     title="#{msgs.strukturelementHinzufuegen}"
                                     onclick="PF('dialogAddDocStrucType').show();">
                        <f:setPropertyActionListener value="#{item}" target="#{Metadaten.myStrukturelement}"/>
                    </p:commandButton>

                    <p:commandButton icon="ui-icon-trash"
                                     update="tabView:structureData:structureDataTable,tabView:structureData:messagesStructureData,docStruc"
                                     title="#{msgs.strukturelementLoeschen}" action="#{Metadaten.deleteNode}">
                        <f:setPropertyActionListener value="#{item}" target="#{Metadaten.myStrukturelement}"/>
                    </p:commandButton>
                </p:column>
            </p:treeTable>
        </h:panelGroup>
    </h:form>

    <p:dialog id="dialogEditDocStrucTypeId" header="#{msgs.docstructTypeAendern}" resizable="false"
              widgetVar="dialogEditDocStrucType" minHeight="40" width="300" height="100" modal="true"
              appendTo="@(body)">
        <h:form id="dialogEditDocStrucTypeForm">
            <p:selectOneMenu id="docStructTypeSelection" value="#{Metadaten.tempTyp}">
                <!--TODO check addable types-->
                <f:selectItems value="#{Metadaten.addableDocStructTypenAlsNachbar}"/>
            </p:selectOneMenu>
            <p:commandButton value="#{msgs.uebernehmen}" action="#{Metadaten.changeCurrentDocstructType}"
                             update="tabView:structureData:structureDataTable,tabView:structureData:messagesStructureData"
                             oncomplete="PF('dialogEditDocStrucType').hide();">
            </p:commandButton>
        </h:form>
    </p:dialog>

    <p:dialog id="dialogAddDocStrucTypeId" header="#{msgs.neuesStrukturelement}" resizable="false"
              widgetVar="dialogAddDocStrucType" width="400" height="400" modal="true"
              appendTo="@(body)">
        <h:form id="dialogAddDocStrucTypeForm">

            <h:panelGrid columns="2">
                <h:outputLabel value="#{msgs.position}:" for="docStructPositionSelection"/>
                <p:selectOneMenu id="docStructPositionSelection" value="#{Metadaten.positionOfNewDocStrucElement}">
                    <!--TODO check addable types-->
                    <f:selectItems value="#{Metadaten.positionsOfNewDocStrucElement}" var="positionSelection"
                                   itemValue="#{positionSelection}" itemLabel="#{positionSelection.label}"/>
                    <p:ajax update="docStructAddTypeSelection"/>
                </p:selectOneMenu>

                <h:outputLabel value="#{msgs.typ}:" for="docStructAddTypeSelection"/>
                <p:selectOneMenu id="docStructAddTypeSelection" value="#{Metadaten.tempTyp}">
                    <!--TODO check addable types-->
                    <f:selectItems value="#{Metadaten.addableDocStructTypes}"/>
                </p:selectOneMenu>
            </h:panelGrid>

            <br/>

            <h:outputText value="#{msgs.vorgaben}:"/>

            <p:tabView>
                <p:tab title="#{msgs.seitenzuordnung}">
                    <h:panelGrid columns="2">
                        <h:outputText value="#{msgs.ersteSeite}:"/>
                        <p:selectOneMenu id="selectFirstPageOnAddNode" value="#{Metadaten.pagesStart}" filter="true"
                                         filterMatchMode="startsWith">
                            <f:selectItems value="#{Metadaten.allPages}"/>
                        </p:selectOneMenu>

                        <h:outputText value="#{msgs.letzteSeite}:"/>
                        <p:selectOneMenu id="selectLastPageOnAddNode" value="#{Metadaten.pagesEnd}" filter="true"
                                         filterMatchMode="startsWith">
                            <f:selectItems value="#{Metadaten.allPages}"/>
                        </p:selectOneMenu>

                        <p:commandButton id="addSingleDocStrucSubmitBtn" value="#{msgs.uebernehmen}" action="#{Metadaten.addNode}"
                                         update="tabView:structureData:structureDataTable,tabView:structureData:messagesStructureData,docStruc"
                                         oncomplete="PF('dialogAddDocStrucType').hide();"/>

                    </h:panelGrid>
                </p:tab>
                <p:tab title="#{msgs.metadaten}">


                </p:tab>
            </p:tabView>


        </h:form>
    </p:dialog>

    <p:dialog id="dialogEditPagesId" header="#{msgs.seitenzuordnung}" resizable="false"
              widgetVar="dialogEditPages" width="400">
        <h:form id="dialogEditPagesForm">

            <p:fieldset legend="#{msgs.seitenzuordnung}">
                <p:messages id="messagesSetFirstAndLastPage" closable="true"/>
                <h:panelGrid columns="2">

                    <h:outputText value="#{msgs.ersteSeite}:"/>
                    <p:selectOneMenu id="selectFirstPage" value="#{Metadaten.allPagesSelectionFirstPage}" filter="true"
                                     filterMatchMode="startsWith">
                        <f:selectItems value="#{Metadaten.allPages}"/>
                    </p:selectOneMenu>

                    <h:outputText value="#{msgs.letzteSeite}:"/>
                    <p:selectOneMenu id="selectLastPage" value="#{Metadaten.allPagesSelectionLastPage}" filter="true"
                                     filterMatchMode="startsWith">
                        <f:selectItems value="#{Metadaten.allPages}"/>
                    </p:selectOneMenu>

                    <p:commandButton id="takePagesFromChildrenBtn" value="#{msgs.seitenVonUnterelementenZuweisen}"
                                     action="#{Metadaten.takePagesFromChildren}"
                                     update="paginationSubSelection,messagesSetFirstAndLastPage,tabView:structureData:structureDataTable"/>
                    <p:commandButton id="setPageStartAndEndBtn" value="#{msgs.seitenZuweisen}"
                                     action="#{Metadaten.setPageStartAndEnd}"
                                     update="paginationSubSelection,messagesSetFirstAndLastPage,tabView:structureData:structureDataTable"/>

                </h:panelGrid>

            </p:fieldset>

            <h:panelGrid id="mygrid7" columns="3" columnClasses="top,centered,top">
                <!-- alle Seiten -->
                <h:panelGroup style="margin-left:0px">
                    <h:outputText value="#{msgs.alleSeiten}"/>
                    <p:selectManyMenu id="paginationSelection" value="#{Metadaten.allPagesSelection}"
                                      style="height:200px">
                        <f:selectItems value="#{Metadaten.allPages}"/>
                    </p:selectManyMenu>
                </h:panelGroup>

                <h:panelGroup>
                    <h:panelGrid columns="1">
                        <p:commandButton id="addPageBtn" action="#{Metadaten.addPages}" icon="ui-icon-arrowthick-1-e"
                                         update="paginationSubSelection,tabView:structureData:structureDataTable"/>
                        <p:commandButton id="removePageBtn" action="#{Metadaten.removePages}"
                                         icon="ui-icon-arrowthick-1-w"
                                         update="paginationSubSelection,tabView:structureData:structureDataTable"/>
                    </h:panelGrid>
                </h:panelGroup>

                <h:panelGroup>
                    <h:outputText value="#{msgs.zugehoerigeSeiten}"/>
                    <p:selectManyMenu id="paginationSubSelection" value="#{Metadaten.structSeitenAuswahl}"
                                      style="height:200px">
                        <f:selectItems value="#{Metadaten.structSeiten}"/>
                        <p:ajax update="paginationSubSelection"/>
                    </p:selectManyMenu>
                </h:panelGroup>
            </h:panelGrid>
        </h:form>
    </p:dialog>
</ui:composition>
