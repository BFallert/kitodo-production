<!DOCTYPE html>
<!--
 *
 * (c) Kitodo. Key to digital objects e. V. <contact@kitodo.org>
 *
 * This file is part of the Kitodo project.
 *
 * It is licensed under GNU General Public License version 3 or later.
 *
 * For the full copyright and license information, please read the
 * GPL3-License.txt file that was distributed with this source code.
 *
-->

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:o="http://omnifaces.org/ui">

    <f:view locale="#{SpracheForm.locale}">
        <ui:include src="inc/head.xhtml" />
        <h:body>
            <script type="text/javascript">
                //<![CDATA[
                    function createMapping() {
                        toggleButtons(false);
                        document.getElementById('indexing_form:create-mapping-loading').style.display='inline';
                        return true;
                    }

                    function deleteIndex() {
                        toggleButtons(false);
                        document.getElementById('indexing_form:delete-index-loading').style.display='inline';
                        return true;
                    }

                    function toggleProgressPolling(message) {
                        if (message.includes("indexing_started")) {
                            PF('progressPoll').start();
                        } else if (message.includes("indexing_finished")) {
                            PF('progressPoll').stop();
                            $('.refreshTable').click();
                        } else if (message.includes("mapping")) {
                            $('.refreshTable').click();
                            if (message.endsWith("started")) {
                                PF('progressPoll').start();
                            } else if (message.endsWith("finished")) {
                                document.getElementById('indexing_form:create-mapping-loading').style.display='none';
                                PF('progressPoll').stop();
                            } else if (message.endsWith("failed")) {
                                document.getElementById('indexing_form:create-mapping-loading').style.display='none';
                                PF('progressPoll').stop();
                            }
                        } else if (message.includes("deletion")) {
                            $('.refreshTable').click();
                            if (message.endsWith("started")) {
                                PF('progressPoll').start();
                            }
                            if (message.endsWith("finished")) {
                                document.getElementById('indexing_form:delete-index-loading').style.display='none';
                                PF('progressPoll').stop();
                            } else if (message.endsWith("failed")) {
                                document.getElementById('indexing_form:delete-index-loading').style.display='none';
                                PF('progressPoll').stop();
                            }
                        }
                    }

                    function toggleButtons(state) {
                        if(state) {
                            PF('createMapping').enable();
                            PF('deleteIndex').enable();
                            PF('startIndexingBatches').enable();
                            PF('startIndexingDockets').enable();
                            PF('startIndexingProcesses').enable();
                            PF('startIndexingProjects').enable();
                            PF('startIndexingProperties').enable();
                            PF('startIndexingRulesets').enable();
                            PF('startIndexingTasks').enable();
                            PF('startIndexingTemplates').enable();
                            PF('startIndexingUsers').enable();
                            PF('startIndexingUserGroups').enable();
                            PF('startIndexingWorkpieces').enable();
                            PF('startIndexingFilter').enable();
                            PF('startIndexingAll').enable();
                        } else {
                            PF('createMapping').disable();
                            PF('deleteIndex').disable();
                            PF('startIndexingBatches').disable();
                            PF('startIndexingDockets').disable();
                            PF('startIndexingProcesses').disable();
                            PF('startIndexingProjects').disable();
                            PF('startIndexingProperties').disable();
                            PF('startIndexingRulesets').disable();
                            PF('startIndexingTasks').disable();
                            PF('startIndexingTemplates').disable();
                            PF('startIndexingUsers').disable();
                            PF('startIndexingUserGroups').disable();
                            PF('startIndexingWorkpieces').disable();
                            PF('startIndexingFilter').disable();
                            PF('startIndexingAll').disable();
                        }
                    }
                //]]>
            </script>
            <table class="headTable" cellspacing="0" cellpadding="0"
                   style="padding-left:5px;padding-right:5px;margin-top:5px;">
                <ui:include src="inc/tbl_Kopf.xhtml" />
            </table>
            <table cellspacing="5" cellpadding="0" class="layoutTable"
                   align="center">
                <tr>
                    <ui:include src="inc/tbl_Navigation.xhtml" />
                    <td valign="top" class="layoutInhalt">
                        <!-- Breadcrumb -->
                        <h:panelGrid id="id0" width="100%" columns="1" styleClass="layoutInhaltKopf">
                            <h:panelGroup id="id1">
                                <h:link id="id2" value="#{msgs.startseite}" outcome="/pages/Main"/>
                                <f:verbatim> &#8250;&#8250; </f:verbatim>
                                <h:outputText id="id3" value="#{msgs.indexing}"/>
                            </h:panelGroup>
                        </h:panelGrid>
                        <h:form id="indexing_form">
                            <ui:fragment rendered="#{empty indexingForm.serverInformation}">
                                <h:outputText value="The elastic search server is not running."/>
                            </ui:fragment>
                            <ui:fragment rendered="#{not empty indexingForm.serverInformation}">
                                <p:panel widgetVar="indexingTable" id="indexingTable">
                                    <table>
                                        <thead>
                                        <tr>
                                            <th colspan="3"><h:outputText value="#{msgs.mapping}"/></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <!-- Create Mapping -->
                                        <tr>
                                            <td colspan="2">
                                                <p:commandButton widgetVar="createMapping"
                                                                 value="#{msgs.createMapping}"
                                                                 style="width: 100%;"
                                                                 action="#{indexingForm.createMapping()}"
                                                                 disabled="#{indexingForm.indexExists() or indexingForm.indexingInProgress()}"
                                                                 update="indexingTable"
                                                                 onclick="createMapping();"/>
                                            </td>
                                            <td>
                                                <p:graphicImage id="create-mapping-loading" alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px; display: none;"/>
                                                <p:graphicImage id="create-mapping-error" alt="failed" value="/pages/images/fail.svg" style="max-height: 20px;" rendered="#{!indexingForm.indexingInProgress() and indexingForm.indexState == 'MAPPING_ERROR'}"/>
                                                <p:graphicImage id="create-mapping-success" alt="success" value="/pages/images/success.svg" style="max-height: 20px;" rendered="#{!indexingForm.indexingInProgress() and indexingForm.indexState == 'MAPPING_SUCCESS'}"/>
                                            </td>
                                        </tr>
                                        <!-- Delete Index -->
                                        <tr>
                                            <td colspan="2">
                                                <p:commandButton widgetVar="deleteIndex"
                                                                 value="#{msgs.deleteIndex}"
                                                                 style="width: 100%;"
                                                                 action="#{indexingForm.deleteIndex()}"
                                                                 disabled="#{!indexingForm.indexExists() or indexingForm.indexingInProgress()}"
                                                                 update="indexingTable"
                                                                 onclick="return confirm('Do you REALLY want to delete the whole index?');deleteIndex();"/>
                                            </td>
                                            <td>
                                                <p:graphicImage id="delete-index-loading" alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px; display: none;"/>
                                                <p:graphicImage id="delete-index-error" alt="failed" value="/pages/images/fail.svg" style="max-height: 20px;" rendered="#{!indexingForm.indexingInProgress() and indexingForm.indexState == 'DELETE_ERROR'}"/>
                                                <p:graphicImage id="delete-index-success" alt="success" value="/pages/images/success.svg" style="max-height: 20px;" rendered="#{!indexingForm.indexingInProgress() and indexingForm.indexState == 'DELETE_SUCCESS'}"/>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <table>
                                        <thead>
                                            <tr>
                                                <th><h:outputText value="#{msgs.objectType}"/></th>
                                                <th><h:outputText value="#{msgs.startIndexing}"/></th>
                                                <th><h:outputText value="#{msgs.progress}"/></th>
                                                <th><h:outputText value="#{msgs.indexedEntries}"/></th>
                                                <th><h:outputText value="#{msgs.status}"/></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Users -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.users}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingUsers"
                                                                     onclick="PF('usersProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startUserIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.userCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="usersProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.userIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedUsers} / #{indexingForm.userCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('USER') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('USER') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('USER') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- User groups -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.benutzergruppen}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingUserGroups"
                                                                     onclick="PF('userGroupsProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startUserGroupIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.userGroupCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="userGroupsProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.userGroupIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedUserGroups} / #{indexingForm.userGroupCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('USERGROUP') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('USERGROUP') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('USERGROUP') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Projects -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.projekte}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingProjects"
                                                                     onclick="PF('projectsProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startProjectIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.projectCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="projectsProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.projectsIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedProjects} / #{indexingForm.projectCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('PROJECT') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('PROJECT') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('PROJECT') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Rulesets -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.regelsaetze}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingRulesets"
                                                                     onclick="PF('rulesetsProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startRulesetIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.rulesetCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="rulesetsProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.rulesetsIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedRulesets} / #{indexingForm.rulesetCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('RULESET') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('RULESET') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('RULESET') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Dockets -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.dockets}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingDockets"
                                                                     onclick="PF('docketsProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startDocketIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.docketCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="docketsProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.docketsIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedDockets} / #{indexingForm.docketCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('DOCKET') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('DOCKET') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('DOCKET') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Tasks -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.schritte}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingTasks"
                                                                     onclick="PF('tasksProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startTaskIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.taskCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="tasksProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.tasksIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedTasks} / #{indexingForm.taskCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('TASK') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('TASK') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('TASK') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Templates -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.templateProperties}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingTemplates"
                                                                     onclick="PF('templatesProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startTemplateIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.templateCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="templatesProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.templatesIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedTemplates} / #{indexingForm.templateCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('TEMPLATE') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('TEMPLATE') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('TEMPLATE') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Processes -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.prozesse}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingProcesses"
                                                                     onclick="PF('processesProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startProcessIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.processCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="processesProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.processIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedProcesses} / #{indexingForm.processCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('PROCESS') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('PROCESS') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('PROCESS') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Batches -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.batches}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingBatches"
                                                                     onclick="PF('batchesProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startBatchIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.batchCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="batchesProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.batchIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedBatches} / #{indexingForm.batchCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('BATCH') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('BATCH') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('BATCH') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Properties -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.eigenschaften}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingProperties"
                                                                     onclick="PF('propertiesProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startPropertyIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.propertyCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="propertiesProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.propertiesIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedProperties} / #{indexingForm.propertyCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('PROPERTY') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('PROPERTY') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('PROPERTY') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Workpieces -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.werkstuecke}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingWorkpieces"
                                                                     onclick="PF('workpiecesProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startWorkpieceIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.workpieceCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="workpiecesProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.workpieceIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedWorkpieces} / #{indexingForm.workpieceCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('WORKPIECE') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('WORKPIECE') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('WORKPIECE') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <!-- Filter -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.filter}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingFilter"
                                                                     onclick="PF('filterProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startFilterIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress() or indexingForm.filterCount lt 1)}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="filterProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.filterIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.indexedFilter} / #{indexingForm.filterCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('FILTER') == indexingForm.indexingStartedState}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('FILTER') == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.getObjectIndexState('FILTER') == indexingForm.indexingSuccessfulState}" />
                                                </td>
                                            </tr>

                                            <tr>
                                                <td colspan="6"><hr/></td>
                                            </tr>

                                            <!-- Whole index -->
                                            <tr>
                                                <td><h:outputText value="#{msgs.wholeIndex}"/></td>
                                                <td>
                                                    <p:commandButton widgetVar="startIndexingAll"
                                                                     onclick="PF('allProgress').start();toggleButtons(false);"
                                                                     value="#{msgs.startIndexing}"
                                                                     action="#{indexingForm.startAllIndexing()}"
                                                                     disabled="#{!indexingForm.indexExists() or (indexingForm.indexingInProgress())}"/>
                                                </td>
                                                <td>
                                                    <p:progressBar widgetVar="allProgress"
                                                                   ajax="true"
                                                                   value="#{indexingForm.allIndexingProgress}"
                                                                   labelTemplate="{value}%"
                                                                   global="false"
                                                                   style="width: 100px;">
                                                    </p:progressBar>
                                                </td>
                                                <td style="text-align: right;">
                                                    <h:outputText value="#{indexingForm.allIndexed} / #{indexingForm.totalCount}"/>
                                                </td>
                                                <td>
                                                    <p:graphicImage alt="in progress" value="/pages/images/ajax-loader.gif" style="max-height: 20px" rendered="#{indexingForm.indexingInProgress()}"/>
                                                    <p:graphicImage alt="failed" value="/pages/images/fail.svg" style="max-height: 20px" rendered="#{indexingForm.allObjectsIndexingState == indexingForm.indexingFailedState}"/>
                                                    <p:graphicImage alt="success" value="/pages/images/success.svg" style="max-height: 20px" rendered="#{indexingForm.allObjectsIndexingState == indexingForm.indexingSuccessfulState and not indexingForm.indexingInProgress()}" />
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <h:outputText value="Indexing started by '#{LoginForm.myBenutzer.surname}, #{LoginForm.myBenutzer.name}' at #{indexingForm.indexingStartedTime}" rendered="#{not empty indexingForm.indexingStartedTime}"/>
                                </p:panel>
                                <p:commandButton class="refreshTable" update="indexingTable" style="visibility: hidden;"/>
                                <p:poll widgetVar="progressPoll" update="indexingTable" interval="1" autoStart="false"/>
                                <o:socket channel="togglePollingChannel" onmessage="toggleProgressPolling" />
                            </ui:fragment>
                        </h:form>
                    </td>
                </tr>
                <ui:include src="inc/tbl_Fuss.xhtml" />
            </table>
        </h:body>
    </f:view>

</html>
